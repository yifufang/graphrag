#!/usr/bin/env python3
"""
å±•ç¤ºGraphRAGå®ä½“ç±»å‹å’ŒPromptä¼˜åŒ–çš„æ”¹è¿›å†…å®¹
"""

def show_entity_types_changes():
    """å±•ç¤ºå®ä½“ç±»å‹çš„æ”¹è¿›"""
    print("ğŸ”§ å®ä½“ç±»å‹é…ç½®ä¼˜åŒ– (settings.yaml)")
    print("="*60)
    
    print("ğŸ“‹ ä¼˜åŒ–å‰ (6ä¸ªç±»å‹):")
    old_types = ['è¯æ', 'æ–¹å‰‚', 'ç–¾ç—…', 'ç—‡çŠ¶', 'åŒ»å®¶', 'åŠŸæ•ˆ']
    for i, entity_type in enumerate(old_types, 1):
        print(f"   {i}. {entity_type}")
    
    print(f"\nğŸ“ˆ ä¼˜åŒ–å (13ä¸ªç±»å‹):")
    new_types = ['è¯æ', 'æ–¹å‰‚', 'ç–¾ç—…', 'ç—‡çŠ¶', 'åŒ»å®¶', 'åŠŸæ•ˆ', 'ç—…å› ', 'è„‰è±¡', 'è¯Šæ–­æ–¹æ³•', 'ç»ç»œ', 'ç©´ä½', 'è„è…‘', 'å…¶ä»–']
    for i, entity_type in enumerate(new_types, 1):
        if i <= 6:
            print(f"   {i}. {entity_type} âœ…")
        elif entity_type == 'å…¶ä»–':
            print(f"   {i}. {entity_type} ğŸ›¡ï¸ (å…œåº•ç±»å‹)")
        else:
            print(f"   {i}. {entity_type} â­ (æ–°å¢)")
    
    print(f"\nğŸ’¡ æ”¹è¿›æ•ˆæœé¢„æœŸ:")
    print("- âœ… è¦†ç›–ä¹‹å‰'é¢å¤–åˆ›é€ 'çš„79ä¸ªå®ä½“(2.1%)")
    print("- âœ… å¤§å¹…å‡å°‘447ä¸ªç©ºtypeå®ä½“(11.7%)")
    print("- âœ… æé«˜å®ä½“åˆ†ç±»çš„å‡†ç¡®æ€§å’Œå®Œæ•´æ€§")

def show_prompt_constraints_changes():
    """å±•ç¤ºPromptçº¦æŸçš„æ”¹è¿›"""
    print(f"\nğŸ¯ Promptçº¦æŸå¼ºåŒ– (extract_graph.txt)")
    print("="*60)
    
    print("ğŸ“‹ ä¼˜åŒ–å‰çš„é—®é¢˜:")
    print("âŒ 'ä»¥ä¸‹ç±»å‹ä¹‹ä¸€ï¼š[{entity_types}]' - çº¦æŸä¸å¤Ÿå¼º")
    print("âŒ æ²¡æœ‰æ˜ç¡®è¯´æ˜æ— æ³•åˆ†ç±»æ—¶æ€ä¹ˆåŠ")
    print("âŒ å…è®¸LLMè‡ªç”±å‘æŒ¥ï¼Œå¯¼è‡´åˆ›é€ æ–°ç±»å‹")
    print("âŒ æ²¡æœ‰ç¦æ­¢ç•™ç©ºtypeå­—æ®µ")
    
    print(f"\nğŸ“ˆ ä¼˜åŒ–åçš„çº¦æŸ:")
    print("âœ… 'å¿…é¡»æ˜¯ä»¥ä¸‹ç±»å‹ä¹‹ä¸€ï¼š[{entity_types}]'")
    print("âœ… 'âš ï¸ é‡è¦çº¦æŸï¼š'")
    print("âœ… '* æ¯ä¸ªå®ä½“éƒ½å¿…é¡»åˆ†é…ä¸€ä¸ªç±»å‹ï¼Œç»å¯¹ä¸å…è®¸ç•™ç©º'")
    print("âœ… '* åªèƒ½ä½¿ç”¨ä¸Šè¿°é¢„å®šä¹‰ç±»å‹ï¼Œä¸å¾—åˆ›é€ æ–°ç±»å‹'")
    print("âœ… '* å¦‚æœå®ä½“ä¸æ˜ç¡®å±äºä»»ä½•ç‰¹å®šç±»å‹ï¼Œä½¿ç”¨\"å…¶ä»–\"ç±»å‹'")
    print("âœ… '* ä¼˜å…ˆé€‰æ‹©æœ€åŒ¹é…çš„å…·ä½“ç±»å‹ï¼Œ\"å…¶ä»–\"ä»…ä½œä¸ºæœ€åé€‰æ‹©'")

def show_prompt_examples_changes():
    """å±•ç¤ºPromptç¤ºä¾‹çš„æ”¹è¿›"""
    print(f"\nğŸ“ Promptç¤ºä¾‹æ‰©å……")
    print("="*60)
    
    print("ğŸ“‹ æ–°å¢å®ä½“ç±»å‹ç¤ºä¾‹:")
    examples = [
        ("è‚ç»", "ç»ç»œ", "å±•ç¤ºç»ç»œå½’ç»çš„è¯†åˆ«"),
        ("æµ®ç´§è„‰", "è„‰è±¡", "å±•ç¤ºè„‰è±¡ç‰¹å¾çš„è¯†åˆ«"), 
        ("æœ›é—»é—®åˆ‡", "è¯Šæ–­æ–¹æ³•", "å±•ç¤ºè¯Šæ–­æ–¹æ³•çš„è¯†åˆ«"),
        ("å¤–æ„Ÿé£é‚ª", "ç—…å› ", "å±•ç¤ºç—…å› ç—…æœºçš„è¯†åˆ«"),
        ("å›è‡£ä½ä½¿", "å…¶ä»–", "å±•ç¤º'å…¶ä»–'ç±»å‹çš„æ­£ç¡®ä½¿ç”¨")
    ]
    
    for entity, entity_type, description in examples:
        print(f"âœ… {entity} â†’ {entity_type} ({description})")
    
    print(f"\nğŸ’¡ ç¤ºä¾‹æ”¹è¿›ç›®çš„:")
    print("- ğŸ¯ è®©LLMå­¦ä¼šæ­£ç¡®ä½¿ç”¨æ–°å¢çš„å®ä½“ç±»å‹")
    print("- ğŸ›¡ï¸ å±•ç¤º'å…¶ä»–'ç±»å‹çš„ä½¿ç”¨åœºæ™¯")
    print("- ğŸ“š æä¾›å…·ä½“çš„ä¸­åŒ»æœ¯è¯­åˆ†ç±»æŒ‡å¯¼")

def show_coverage_analysis():
    """å±•ç¤ºè¦†ç›–èŒƒå›´åˆ†æ"""
    print(f"\nğŸ“Š å®ä½“è¦†ç›–èŒƒå›´åˆ†æ")
    print("="*60)
    
    # åŸºäºä¹‹å‰çš„æ•°æ®åˆ†æ
    old_coverage = {
        'é¢„å®šä¹‰ç±»å‹': (3307, 86.3),
        'é¢å¤–åˆ›é€ ç±»å‹': (79, 2.1),
        'ç©ºtype': (447, 11.7)
    }
    
    print("ğŸ“‹ ä¼˜åŒ–å‰çš„è¦†ç›–æƒ…å†µ:")
    for category, (count, percentage) in old_coverage.items():
        if category == 'é¢„å®šä¹‰ç±»å‹':
            print(f"âœ… {category}: {count:,} ({percentage}%)")
        else:
            print(f"âŒ {category}: {count:,} ({percentage}%)")
    
    print(f"\nğŸ“ˆ ä¼˜åŒ–åé¢„æœŸæ”¹è¿›:")
    print("âœ… æ–°å¢7ä¸ªé‡è¦ä¸­åŒ»ç±»å‹ï¼Œé¢„è®¡è¦†ç›–åŸæœ‰79ä¸ªé¢å¤–ç±»å‹")
    print("âœ… å¼ºåŒ–çº¦æŸåï¼Œé¢„è®¡å°†447ä¸ªç©ºtypeå‡å°‘åˆ°<50ä¸ª")
    print("âœ… é¢„æœŸè¦†ç›–ç‡ä»86.3%æå‡åˆ°95%+")
    
    print(f"\nğŸ¯ å…·ä½“ç±»å‹æ˜ å°„é¢„æœŸ:")
    type_mapping = [
        ("ç—…å› (15ä¸ª)", "â†’ ç—…å› ç±»å‹"),
        ("è„‰è±¡(11ä¸ª)", "â†’ è„‰è±¡ç±»å‹"),
        ("è¯Šæ–­æ–¹æ³•(7ä¸ª)", "â†’ è¯Šæ–­æ–¹æ³•ç±»å‹"),
        ("ç»ç»œ(6ä¸ª)", "â†’ ç»ç»œç±»å‹"),
        ("ç©´ä½(5ä¸ª)", "â†’ ç©´ä½ç±»å‹"),
        ("è„è…‘(5ä¸ª)", "â†’ è„è…‘ç±»å‹"),
        ("å…¶ä»–è¾¹ç¼˜ç±»å‹", "â†’ å…¶ä»–ç±»å‹")
    ]
    
    for old, new in type_mapping:
        print(f"   {old} {new}")

def show_usage_instructions():
    """å±•ç¤ºä½¿ç”¨è¯´æ˜"""
    print(f"\nğŸš€ ä¼˜åŒ–åçš„ä½¿ç”¨æµç¨‹")
    print("="*60)
    
    print("1. ğŸ“ é‡æ–°è¿è¡ŒGraphRAGç´¢å¼•:")
    print("   python -m graphrag.index --root . --config ragtest/settings.yaml")
    
    print(f"\n2. ğŸ”§ é‡æ–°æ„å»ºNeo4jæ•°æ®åº“:")
    print("   python ragtest/build_neo4j.py")
    
    print(f"\n3. ğŸ“Š éªŒè¯æ”¹è¿›æ•ˆæœ:")
    print("   python ragtest/neomodel_query.py")
    
    print(f"\n4. ğŸ¯ é¢„æœŸç»“æœ:")
    print("   - ç©ºtypeå®ä½“æ•°é‡å¤§å¹…å‡å°‘")
    print("   - ä¸å†æœ‰é¢å¤–åˆ›é€ çš„ç±»å‹")
    print("   - å®ä½“åˆ†ç±»æ›´åŠ è§„èŒƒå’Œå®Œæ•´")
    
    print(f"\nğŸ’¡ æ³¨æ„äº‹é¡¹:")
    print("- âš ï¸ é‡æ–°ç´¢å¼•ä¼šé‡æ–°å¤„ç†æ‰€æœ‰æ–‡æ¡£ï¼Œéœ€è¦æ—¶é—´")
    print("- ğŸ’¾ å»ºè®®å¤‡ä»½ç°æœ‰çš„Neo4jæ•°æ®åº“")
    print("- ğŸ“Š å¯ä»¥å¯¹æ¯”ä¼˜åŒ–å‰åçš„å®ä½“ç»Ÿè®¡")

def main():
    """ä¸»å‡½æ•°"""
    print("ğŸ‰ GraphRAGå®ä½“ç±»å‹å’ŒPromptä¼˜åŒ–æ€»ç»“")
    print("="*60)
    
    show_entity_types_changes()
    show_prompt_constraints_changes()
    show_prompt_examples_changes()
    show_coverage_analysis()
    show_usage_instructions()
    
    print(f"\nğŸ“‹ ä¼˜åŒ–æ€»ç»“:")
    print("="*60)
    print("ğŸ¯ æ ¸å¿ƒæ”¹è¿›:")
    print("   1. æ‰©å±•å®ä½“ç±»å‹ï¼š6ä¸ª â†’ 13ä¸ª(åŒ…å«å…œåº•ç±»å‹)")
    print("   2. å¼ºåŒ–Promptçº¦æŸï¼šæ˜ç¡®ç¦æ­¢ç•™ç©ºå’Œåˆ›é€ æ–°ç±»å‹")
    print("   3. ä¸°å¯Œç¤ºä¾‹æŒ‡å¯¼ï¼šå±•ç¤ºæ–°ç±»å‹å’Œè¾¹ç•Œæƒ…å†µå¤„ç†")
    print("")
    print("âœ… é¢„æœŸæ•ˆæœ:")
    print("   - æ¶ˆé™¤447ä¸ªç©ºtypeå®ä½“(11.7%)")
    print("   - è§„èŒƒ79ä¸ªé¢å¤–ç±»å‹å®ä½“(2.1%)")
    print("   - æå‡å®ä½“åˆ†ç±»å‡†ç¡®ç‡åˆ°95%+")
    print("")
    print("ğŸš€ ä¸‹ä¸€æ­¥:")
    print("   é‡æ–°è¿è¡ŒGraphRAGç´¢å¼•ï¼ŒéªŒè¯ä¼˜åŒ–æ•ˆæœ")

if __name__ == "__main__":
    try:
        main()
    except Exception as e:
        print(f"âŒ å±•ç¤ºå¤±è´¥: {e}")